# タスク分割: java-calculator-webapp

## プロジェクト情報

- **機能名**: java-calculator-webapp
- **総営業日数**: 10営業日（営業日ベース）
- **総工数見積**: 8人日
- **休日**: 土曜日・日曜日を除外
- **注意**: このタスク分割は営業日ベースで作成されています（土日・祝日を除外）

## Phase 0.1: 要件定義（Requirements）

**期間**: 完了済み
**工数**: 0.5人日
**ステータス**: 完了

### Story 0.1.1: 要件定義書作成
- **担当**: @PM
- **工数**: 0.5人日
- **説明**: 機能の要件定義書を作成
- **成果物**:
  - `.kiro/specs/java-calculator-webapp/requirements.md`
  - Confluenceページ（要件定義）
- **受け入れ基準**:
  - [x] 機能要件が定義されている
  - [x] 非機能要件が定義されている
  - [x] ユースケースが記載されている
  - [x] PM承認済み

## Phase 0.2: 設計（Design）

**期間**: 完了済み
**工数**: 1.0人日
**ステータス**: 完了

### Story 0.2.1: 基本設計
- **担当**: @Architect
- **工数**: 1.0人日
- **説明**: アーキテクチャ設計、API設計、コンポーネント設計を実施
- **成果物**:
  - `.kiro/specs/java-calculator-webapp/design.md`
  - Confluenceページ（設計書）
- **受け入れ基準**:
  - [x] システム構成図が作成されている
  - [x] レイヤー構成が定義されている（3層アーキテクチャ + SPA）
  - [x] API仕様が詳細に記載されている
  - [x] コンポーネント設計が完了している（ExpressionParser、CalculatorService、CalculatorController、CalculatorUI）
  - [x] Architect承認済み

## Phase 2: TDD実装（Implementation）

**期間**: Day 1-8
**工数**: 6.5人日
**ステータス**: 未着手

### Story 2.1: Spring Bootプロジェクトの初期化
- **担当**: @Developer
- **工数**: 0.25人日
- **説明**: Java 17 LTSを使用してSpring Boot 3.xプロジェクトを作成し、ビルド環境を構成
- **タスク**:
  - Spring Boot 3.xプロジェクトを作成
  - Maven/Gradleでビルド設定を構成
  - アプリケーション設定ファイル（application.properties/yml）を作成
  - プロジェクトのビルドと起動を確認
- **成果物**:
  - Spring Bootプロジェクト構造
  - ビルド設定ファイル（pom.xml または build.gradle）
  - アプリケーション設定ファイル
- **受け入れ基準**:
  - [x] プロジェクトがビルド成功する
  - [x] Spring Bootアプリケーションが正常に起動する
  - [x] 要件5.4: JavaScriptでUIロジックを実装し、計算処理はバックエンドAPIで実行

### Story 2.2: 依存関係とパッケージ構造の確立
- **担当**: @Developer
- **工数**: 0.25人日
- **説明**: 必要なライブラリをプロジェクトに追加し、パッケージ構造を作成
- **タスク**:
  - exp4j 0.4.8（式評価ライブラリ）をMaven/Gradleに追加
  - Spring Boot Starter Web依存関係を追加
  - JUnit 5、AssertJ、Mockitoのテスト依存関係を追加
  - コントローラー、サービス、パーサーのパッケージ構造を作成
  - 静的コンテンツ（HTML/CSS/JS）用のリソースディレクトリを作成
- **成果物**:
  - 更新された依存関係設定
  - パッケージ構造（com.example.calculator.controller, service, parser）
  - リソースディレクトリ（src/main/resources/static）
- **受け入れ基準**:
  - [x] すべての依存関係が正常に解決される
  - [x] パッケージ構造が設計通りに作成されている
  - [x] 要件5.4: JavaScriptでUIロジックを実装し、計算処理はバックエンドAPIで実行

### Story 2.3: 式パーサーの実装（TDD）
- **担当**: @Developer
- **工数**: 1.0人日
- **説明**: exp4jライブラリを使用して数式を評価する機能を実装（TDDアプローチ）
- **タスク**:
  - **Red**: 基本演算のテストケースを作成（失敗することを確認）
  - **Green**: exp4jを使用して四則演算（+, -, *, /）を実装
  - **Refactor**: コードをリファクタリング
  - 演算優先順位（乗除が加減より優先）のテストと実装
  - 整数および小数点数の計算テストと実装
  - 構文エラー検出のテストと実装
  - ゼロ除算検出のテストと実装
- **成果物**:
  - ExpressionParserインターフェースと実装クラス
  - 単体テスト（カバレッジ95%以上）
- **受け入れ基準**:
  - [ ] 要件1.1-1.5: 四則演算（加算、減算、乗算、除算）が正常に動作し、整数および小数点数をサポート
  - [ ] 要件3.2: 複雑な式（例：2 + 3 * 4）を評価し、演算の優先順位を正しく処理
  - [ ] 要件4.1: ゼロ除算時にArithmeticExceptionをスロー
  - [ ] 要件4.3: 無効な入力パターンを検出してSyntaxExceptionをスロー
  - [ ] すべての単体テストが成功する

### Story 2.4: 計算サービスの実装（TDD）
- **担当**: @Developer
- **工数**: 0.5人日
- **説明**: ビジネスロジックを調整し、精度制御とエラーハンドリングを実装
- **タスク**:
  - **Red**: 精度制御のテストケースを作成
  - **Green**: ExpressionParserを呼び出し、結果を小数点以下8桁に丸める
  - 例外変換のテストと実装（SyntaxException → InvalidExpressionException）
  - 数値オーバーフロー検出のテストと実装
- **成果物**:
  - CalculatorServiceインターフェースと実装クラス
  - ビジネス例外クラス（InvalidExpressionException, DivisionByZeroException, OverflowException）
  - 単体テスト
- **受け入れ基準**:
  - [ ] 要件3.3: 計算結果が小数点以下8桁まで表示される
  - [ ] 要件4.1: ゼロ除算時に適切な例外をスロー
  - [ ] 要件4.2: 数値オーバーフロー時にOverflowExceptionをスロー
  - [ ] 要件4.3: 無効な入力時にInvalidExpressionExceptionをスロー
  - [ ] すべての単体テストが成功する

### Story 2.5: REST APIエンドポイントの実装
- **担当**: @Developer
- **工数**: 0.75人日
- **説明**: POST /api/calculator/evaluateエンドポイントを作成し、HTTPリクエスト・レスポンスを処理
- **タスク**:
  - CalculatorControllerクラスを作成
  - EvaluationRequestモデル（expression: String）を定義
  - EvaluationResponseモデル（result: Double, error: String）を定義
  - CalculatorServiceを呼び出して式を評価
  - 適切なHTTPステータスコード（200, 400, 422, 500）を返す
  - 統合テスト（MockMvc）を作成
- **成果物**:
  - CalculatorControllerクラス
  - リクエスト・レスポンスモデル
  - 統合テスト
- **受け入れ基準**:
  - [ ] 要件3.1: イコールボタンをクリックすると式を評価し結果を表示
  - [ ] 要件4.1: ゼロ除算時に422ステータスと「エラー: ゼロ除算」を返す
  - [ ] 要件4.2: 数値オーバーフロー時に422ステータスと「エラー: 数値が範囲外」を返す
  - [ ] 要件4.3: 無効な入力時に400ステータスを返す
  - [ ] 統合テストがすべて成功する
- **依存関係**: Story 2.3, 2.4完了後

### Story 2.6: CORS設定とグローバルエラーハンドリング
- **担当**: @Developer
- **工数**: 0.25人日
- **説明**: フロントエンドとの統合のためにCORS設定とグローバルエラーハンドラーを実装
- **タスク**:
  - @CrossOriginまたはグローバルCORS設定を有効化
  - @ControllerAdviceでグローバルエラーハンドラーを実装
  - すべての例外をキャッチして適切なHTTPレスポンスに変換
  - エラーログをLogbackで記録
- **成果物**:
  - CORS設定クラス
  - グローバルエラーハンドラークラス
- **受け入れ基準**:
  - [ ] 要件4.1-4.3: すべてのエラーが適切に処理される
  - [ ] CORSエラーが発生しない
  - [ ] エラーログが記録される

### Story 2.7: 電卓UIのHTMLレイアウト作成
- **担当**: @Developer
- **工数**: 0.5人日
- **説明**: セマンティックなHTML5マークアップで電卓レイアウトを作成
- **タスク**:
  - ディスプレイエリア（計算式と結果を表示）を実装
  - 0-9の数字ボタンを実装
  - +、-、*、/の演算子ボタンを実装
  - 小数点（.）ボタンを実装
  - クリア（C）ボタンを実装
  - イコール（=）ボタンを実装
- **成果物**:
  - index.html（static/index.html）
- **受け入れ基準**:
  - [ ] 要件2.1: 0から9までの数字ボタンが表示される
  - [ ] 要件2.2: 加算、減算、乗算、除算の演算子ボタンが表示される
  - [ ] 要件2.3: 計算結果を表示するディスプレイエリアが提供される
  - [ ] 要件2.4: クリア（C）ボタンが提供される
  - [ ] 要件2.5: イコール（=）ボタンが提供される
  - [ ] 要件2.6: 小数点（.）ボタンが提供される

### Story 2.8: レスポンシブCSSスタイリング
- **担当**: @Developer
- **工数**: 0.5人日
- **説明**: CSS Grid/Flexboxを使用してレスポンシブな電卓UIをスタイリング
- **タスク**:
  - CSS Grid/Flexboxで電卓レイアウトを構築
  - モバイルデバイス対応のレスポンシブデザインを実装
  - メディアクエリで画面サイズに応じてレイアウトを調整
  - シンプルで視覚的に分かりやすいデザインを実装
  - ボタンのホバー・クリック効果を追加
- **成果物**:
  - style.css（static/css/style.css）
- **受け入れ基準**:
  - [ ] 要件5.2: レスポンシブデザインを実装しモバイルデバイスでも利用可能
  - [ ] 要件5.5: シンプルで視覚的に分かりやすいデザイン
  - [ ] モバイル、タブレット、デスクトップで正しく表示される

### Story 2.9: JavaScript UIロジックとイベントハンドリング
- **担当**: @Developer
- **工数**: 0.75人日
- **説明**: ES6+文法でJavaScript UIロジックを実装し、ユーザー入力を処理
- **タスク**:
  - 数字ボタンクリック時にディスプレイに数値を追加
  - 演算子ボタンクリック時にディスプレイに演算子を追加
  - 式の構築（例：「2 + 3 * 4」）をサポート
  - クリアボタンクリック時に入力をリセット
  - 演算子の連続入力を防止するクライアント側検証を実装
  - 状態管理（currentDisplay、expression、lastResult）を実装
- **成果物**:
  - calculator.js（static/js/calculator.js）
- **受け入れ基準**:
  - [ ] 要件2.7: 数字ボタンをクリックするとディスプレイに数値を追加表示し、式を構築
  - [ ] 要件2.8: 演算子ボタンをクリックすると演算子をディスプレイに追加し、式の一部として記録
  - [ ] 要件3.4: 連続して計算を実行すると前回の結果を新しい計算の開始値として使用可能
  - [ ] 要件4.4: クリアボタンで状態をリセット可能
  - [ ] 演算子の連続入力が防止される
- **依存関係**: Story 2.7完了後

### Story 2.10: バックエンドAPIとの統合
- **担当**: @Developer
- **工数**: 0.75人日
- **説明**: Fetch APIを使用してバックエンドAPIと統合し、計算結果を表示
- **タスク**:
  - イコールボタンクリック時にPOST /api/calculator/evaluateを呼び出す
  - リクエストボディにexpressionを含むJSONを送信
  - レスポンスから計算結果を取得してディスプレイに表示
  - エラーレスポンス（400, 422, 500）を処理してエラーメッセージを表示
  - 連続計算のサポートを実装
  - E2Eテスト（Selenium WebDriver）を作成
- **成果物**:
  - 更新されたcalculator.js
  - E2Eテスト
- **受け入れ基準**:
  - [ ] 要件3.1: イコールボタンをクリックすると入力された式を評価し結果を表示
  - [ ] 要件3.2: 複雑な式（例：2 + 3 * 4）を評価し、演算の優先順位を正しく処理
  - [ ] 要件3.4: 連続して計算を実行すると前回の結果を新しい計算の開始値として使用可能
  - [ ] 要件4.1: ゼロ除算時に「エラー: ゼロ除算」メッセージを表示
  - [ ] 要件4.2: 数値オーバーフロー時に「エラー: 数値が範囲外」メッセージを表示
  - [ ] 要件4.3: 無効な入力パターン時にエラーメッセージを表示
  - [ ] 要件5.4: JavaScriptでUIロジックを実装し、計算処理はバックエンドAPIで実行
  - [ ] E2Eテストがすべて成功する
- **依存関係**: Story 2.5, 2.9完了後

### Story 2.11: クロスブラウザ互換性テスト
- **担当**: @QAEngineer
- **工数**: 0.5人日
- **説明**: Chrome、Firefox、Safari、Edgeでアプリケーションを手動テスト
- **タスク**:
  - 各ブラウザで電卓機能をテスト
  - レスポンシブデザインの表示を確認
  - ES6+のJavaScript機能の互換性を確認
- **受け入れ基準**:
  - [ ] 要件5.1: モダンブラウザ（Chrome、Firefox、Safari、Edge）で動作
  - [ ] すべてのブラウザで電卓機能が正常に動作する
  - [ ] レスポンシブデザインが各ブラウザで正しく表示される
- **依存関係**: Story 2.10完了後

### Story 2.12: パフォーマンス検証と最適化
- **担当**: @Developer
- **工数**: 0.5人日
- **説明**: ページロード時間とAPIレスポンスタイムを測定・最適化
- **タスク**:
  - Chrome DevToolsでページロード時間を測定
  - 静的コンテンツのMinifyを実施
  - Gzip圧縮を有効化
  - JMeterでAPIレスポンスタイムを測定
- **受け入れ基準**:
  - [ ] 要件5.3: ページ読み込み後3秒以内に操作可能な状態
  - [ ] ページロード時間が3秒以内
  - [ ] APIレスポンスタイムが平均100ms以下
- **依存関係**: Story 2.10完了後

## Phase 3: 追加QA（Testing）

**期間**: Day 9
**工数**: 1.0人日
**ステータス**: 未着手

### Story 3.1: 入力検証とセキュリティチェック
- **担当**: @SecurityEngineer
- **工数**: 0.5人日
- **説明**: クライアント側とサーバー側の検証、セキュリティスキャンを実施
- **タスク**:
  - 二重検証（クライアント・サーバー）が実装されていることを確認
  - 式の文字列長制限（最大256文字）を確認
  - 許可する文字のホワイトリストを確認
  - XSS攻撃対策を確認
  - exp4jのセキュリティスキャンを実施
- **受け入れ基準**:
  - [ ] 要件4.3: 無効な入力パターンが検出された場合、計算を実行せずエラーメッセージを表示
  - [ ] クライアント側とサーバー側の二重検証が実装されている
  - [ ] XSS攻撃が防止されている
  - [ ] 既知の脆弱性が検出されない
- **依存関係**: Story 2.12完了後

### Story 3.2: エラーメッセージとUX検証
- **担当**: @QAEngineer
- **工数**: 0.5人日
- **説明**: すべてのエラーケースでユーザーフレンドリーなメッセージが表示されることを確認
- **タスク**:
  - ゼロ除算エラーメッセージを確認
  - 数値オーバーフローエラーメッセージを確認
  - 無効な入力エラーメッセージを確認
  - クリアボタンでの状態リセットを確認
  - エラーメッセージがシステム内部情報を露出していないことを確認
- **受け入れ基準**:
  - [ ] 要件4.1: ゼロ除算時に「エラー: ゼロ除算」メッセージを表示
  - [ ] 要件4.2: 数値オーバーフロー時に「エラー: 数値が範囲外」メッセージを表示
  - [ ] 要件4.3: 無効な入力パターン時にエラーメッセージを表示
  - [ ] 要件4.4: エラー発生時、クリアボタンで状態をリセット可能
  - [ ] エラーメッセージがシステム内部情報を露出していない
- **依存関係**: Story 3.1完了後

## Phase 4: リリース準備（Release Preparation）

**期間**: Day 10
**工数**: 0.5人日
**ステータス**: 未着手

### Story 4.1: 本番環境デプロイ準備
- **担当**: @DevOpsEngineer
- **工数**: 0.5人日
- **説明**: 本番環境設定を確認し、実行可能JARをビルド
- **タスク**:
  - application.propertiesで本番環境設定を確認
  - 実行可能JARをビルド
  - JARファイルの起動と機能を確認
  - Spring Boot Actuatorのヘルスチェックエンドポイントを実装（任意）
- **受け入れ基準**:
  - [ ] 要件5.3: ページ読み込み後3秒以内に操作可能な状態
  - [ ] 要件5.4: JavaScriptでUIロジックを実装し、計算処理はバックエンドAPIで実行
  - [ ] 実行可能JARが正常に起動する
  - [ ] すべての機能が本番環境で動作する
- **依存関係**: Story 3.2完了後

## Phase 5: リリース（Release）

**期間**: Day 11
**工数**: 0.5人日
**ステータス**: 未着手

### Story 5.1: ステージング環境デプロイ
- **担当**: @InfraEngineer
- **工数**: 0.25人日
- **説明**: ステージング環境へのデプロイと最終確認
- **タスク**:
  - ステージング環境デプロイ実施
  - スモークテスト実施
  - 最終確認完了
- **受け入れ基準**:
  - [ ] ステージング環境デプロイ成功
  - [ ] スモークテスト成功
  - [ ] 最終確認完了
- **依存関係**: Story 4.1完了後

### Story 5.2: 本番環境リリース
- **担当**: @InfraEngineer, @PM
- **工数**: 0.25人日
- **説明**: 本番環境へのリリース実施
- **タスク**:
  - 本番環境デプロイ実施
  - スモークテスト実施
  - 監視確認
  - ステークホルダーへの通知
- **受け入れ基準**:
  - [ ] 本番環境デプロイ成功
  - [ ] スモークテスト成功
  - [ ] 監視確認完了
  - [ ] ステークホルダーへの通知完了
- **依存関係**: Story 5.1完了後

## タイムライン（営業日ベース）

**前提**: 土日・祝日を除いた営業日で計算（1日8時間の実開発時間）

### Week 1-2: TDD実装

```text
Day 1（月）:
  - Story 2.1: Spring Bootプロジェクト初期化
  - Story 2.2: 依存関係とパッケージ構造確立

Day 2-3（火水）:
  - Story 2.3: 式パーサー実装（TDD）

Day 4（木）:
  - Story 2.4: 計算サービス実装（TDD）
  - Story 2.5: REST APIエンドポイント実装開始

Day 5（金）:
  - Story 2.5: REST APIエンドポイント実装完了
  - Story 2.6: CORS設定とエラーハンドリング

Day 6（月）:
  - Story 2.7: HTMLレイアウト作成
  - Story 2.8: CSSスタイリング

Day 7（火）:
  - Story 2.9: JavaScript UIロジック実装

Day 8（水）:
  - Story 2.10: バックエンドAPI統合とE2Eテスト
```

### Week 3: QA・リリース

```text
Day 9（木）:
  - Story 2.11: クロスブラウザ互換性テスト
  - Story 2.12: パフォーマンス検証
  - Story 3.1: セキュリティチェック
  - Story 3.2: エラーメッセージ検証

Day 10（金）:
  - Story 4.1: 本番環境デプロイ準備

Day 11（月）:
  - Story 5.1: ステージング環境デプロイ
  - Story 5.2: 本番環境リリース
```

## 見積もりサマリー

| フェーズ | ストーリーポイント | 工数（人日） | ストーリー数 |
|---------|----------------|------------|------------|
| Phase 0.1: 要件定義 | 2 SP | 0.5 日 | 1 |
| Phase 0.2: 設計 | 4 SP | 1.0 日 | 1 |
| Phase 2: TDD実装 | 26 SP | 6.5 日 | 12 |
| Phase 3: 追加QA | 4 SP | 1.0 日 | 2 |
| Phase 4: リリース準備 | 2 SP | 0.5 日 | 1 |
| Phase 5: リリース | 2 SP | 0.5 日 | 2 |
| **合計** | **40 SP** | **10.0 日** | **19** |

**換算レート**: 1 SP ≈ 0.25人日

## JIRAラベル一覧

各ストーリーには以下のラベルが自動付与されます：

**新ワークフロー構造のラベル:**
- `requirements` - Phase 0.1: 要件定義
- `design` - Phase 0.2: 設計
- `implementation` / `tdd-implementation` - Phase 2: TDD実装
- `additional-qa` / `testing` - Phase 3: 追加QA
- `release-prep` / `release-preparation` - Phase 4: リリース準備
- `release` - Phase 5: リリース

**JIRAフィルター例**:
```text
project = PC AND labels = "implementation"     # TDD実装タスクのみ
project = PC AND labels = "testing"            # 追加QAタスクのみ
project = PC AND labels = "release"            # リリースタスクのみ
```

---

**次のステップ**:
1. tasks.mdをレビューして承認
2. `npx tsx ~/Work/git/michi/src/cli.ts phase:run java-calculator-webapp tasks` 実行
3. JIRAに全フェーズのストーリーが自動作成される

**参考ドキュメント**:
- [ワークフローガイド](../../../docs/user-guide/guides/workflow.md)
- [フェーズ自動化ガイド](../../../docs/user-guide/guides/phase-automation.md)
